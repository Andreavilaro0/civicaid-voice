>>> Bootstrap: setting up environment...
  Activating .venv...
  Installing requirements.txt...
  Installing requirements-dev.txt...
  Bootstrap complete. python=/Users/andreaavila/Documents/hakaton/civicaid-voice/.venv/bin/python3 pytest=/Users/andreaavila/Documents/hakaton/civicaid-voice/.venv/bin/pytest ruff=/Users/andreaavila/Documents/hakaton/civicaid-voice/.venv/bin/ruff

=============================================
 CivicAid Voice — Phase 3 Verification
 2026-02-13 01:23:15
=============================================
 Flags: bootstrap=true local=true docker=true render=false twilio=false notion=false

>>> Step 1/4: Running pytest...
============================= test session starts ==============================
platform darwin -- Python 3.11.8, pytest-9.0.2, pluggy-1.6.0 -- /Users/andreaavila/Documents/hakaton/civicaid-voice/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/andreaavila/Documents/hakaton/civicaid-voice
configfile: pyproject.toml
collecting ... collected 96 items

tests/e2e/test_demo_flows.py::test_t9_wa_text_demo_complete PASSED       [  1%]
tests/e2e/test_demo_flows.py::test_t10_wa_audio_demo_stub PASSED         [  2%]
tests/e2e/test_demo_flows.py::test_health_endpoint PASSED                [  3%]
tests/e2e/test_demo_flows.py::test_static_cache_mp3 PASSED               [  4%]
tests/integration/test_pipeline.py::test_t8_pipeline_text_cache_hit PASSED [  5%]
tests/integration/test_pipeline.py::test_pipeline_text_cache_miss_llm_disabled PASSED [  6%]
tests/integration/test_twilio_stub.py::test_send_final_message_text_only PASSED [  7%]
tests/integration/test_twilio_stub.py::test_send_final_message_with_media PASSED [  8%]
tests/integration/test_webhook.py::test_t6_webhook_text PASSED           [  9%]
tests/integration/test_webhook.py::test_t7_webhook_audio PASSED          [ 10%]
tests/integration/test_webhook.py::test_webhook_returns_twiml_xml PASSED [ 11%]
tests/unit/test_cache.py::test_t1_cache_match_keyword_exact PASSED       [ 12%]
tests/unit/test_cache.py::test_t2_cache_match_no_match PASSED            [ 13%]
tests/unit/test_cache.py::test_t3_cache_match_image_demo PASSED          [ 14%]
tests/unit/test_cache.py::test_cache_match_french PASSED                 [ 15%]
tests/unit/test_cache.py::test_cache_match_language_filter PASSED        [ 16%]
tests/unit/test_cache.py::test_cache_match_empty_text PASSED             [ 17%]
tests/unit/test_config.py::test_config_defaults PASSED                   [ 18%]
tests/unit/test_config.py::test_config_demo_mode PASSED                  [ 19%]
tests/unit/test_config.py::test_config_twilio_sandbox_default PASSED     [ 20%]
tests/unit/test_detect_input.py::test_text_input PASSED                  [ 21%]
tests/unit/test_detect_input.py::test_audio_input PASSED                 [ 22%]
tests/unit/test_detect_input.py::test_image_input PASSED                 [ 23%]
tests/unit/test_detect_input.py::test_unknown_media_type PASSED          [ 25%]
tests/unit/test_detect_lang.py::test_t5_detect_french PASSED             [ 26%]
tests/unit/test_detect_lang.py::test_detect_spanish PASSED               [ 27%]
tests/unit/test_detect_lang.py::test_detect_short_text_defaults PASSED   [ 28%]
tests/unit/test_detect_lang.py::test_detect_empty_defaults PASSED        [ 29%]
tests/unit/test_evals.py::test_load_eval_cases PASSED                    [ 30%]
tests/unit/test_evals.py::test_load_eval_cases_missing_dir PASSED        [ 31%]
tests/unit/test_evals.py::test_run_eval_case_pass PASSED                 [ 32%]
tests/unit/test_evals.py::test_run_eval_case_fail_missing PASSED         [ 33%]
tests/unit/test_evals.py::test_run_eval_case_fail_unexpected PASSED      [ 34%]
tests/unit/test_evals.py::test_run_eval_case_no_checks PASSED            [ 35%]
tests/unit/test_evals.py::test_run_eval_set PASSED                       [ 36%]
tests/unit/test_evals.py::test_eval_report_generation PASSED             [ 37%]
tests/unit/test_evals.py::test_eval_runner_with_cache PASSED             [ 38%]
tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm PASSED    [ 39%]
tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm_suicid PASSED [ 40%]
tests/unit/test_guardrails.py::test_pre_check_blocks_violence PASSED     [ 41%]
tests/unit/test_guardrails.py::test_pre_check_blocks_illegal PASSED      [ 42%]
tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm_suicidarme PASSED [ 43%]
tests/unit/test_guardrails.py::test_pre_check_blocks_falsificar_nie PASSED [ 44%]
tests/unit/test_guardrails.py::test_pre_check_allows_safe_input PASSED   [ 45%]
tests/unit/test_guardrails.py::test_pre_check_allows_tramite_questions PASSED [ 46%]
tests/unit/test_guardrails.py::test_pre_check_allows_empadronamiento PASSED [ 47%]
tests/unit/test_guardrails.py::test_post_check_adds_legal_disclaimer PASSED [ 48%]
tests/unit/test_guardrails.py::test_post_check_adds_medical_disclaimer PASSED [ 50%]
tests/unit/test_guardrails.py::test_post_check_no_disclaimer_for_simple_info PASSED [ 51%]
tests/unit/test_guardrails.py::test_post_check_no_duplicate_disclaimer PASSED [ 52%]
tests/unit/test_guardrails.py::test_post_check_redacts_dni PASSED        [ 53%]
tests/unit/test_guardrails.py::test_post_check_redacts_nie PASSED        [ 54%]
tests/unit/test_guardrails.py::test_post_check_redacts_phone PASSED      [ 55%]
tests/unit/test_guardrails.py::test_post_check_preserves_clean_text PASSED [ 56%]
tests/unit/test_guardrails.py::test_guardrails_flag_default_on PASSED    [ 57%]
tests/unit/test_guardrails.py::test_guardrails_flag_can_be_disabled PASSED [ 58%]
tests/unit/test_kb_lookup.py::test_t4_kb_lookup_empadronamiento PASSED   [ 59%]
tests/unit/test_kb_lookup.py::test_kb_lookup_imv PASSED                  [ 60%]
tests/unit/test_kb_lookup.py::test_kb_lookup_tarjeta PASSED              [ 61%]
tests/unit/test_kb_lookup.py::test_kb_lookup_no_match PASSED             [ 62%]
tests/unit/test_observability.py::test_request_context_creation PASSED   [ 63%]
tests/unit/test_observability.py::test_timing_tracking PASSED            [ 64%]
tests/unit/test_observability.py::test_to_dict PASSED                    [ 65%]
tests/unit/test_observability.py::test_context_thread_local PASSED       [ 66%]
tests/unit/test_observability.py::test_clear_context PASSED              [ 67%]
tests/unit/test_observability.py::test_observability_flag_off PASSED     [ 68%]
tests/unit/test_redteam.py::TestRedTeamDataFile::test_redteam_file_exists PASSED [ 69%]
tests/unit/test_redteam.py::TestRedTeamDataFile::test_redteam_file_valid_json PASSED [ 70%]
tests/unit/test_redteam.py::TestRedTeamDataFile::test_redteam_cases_have_required_fields PASSED [ 71%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_guardrails_module_exists PASSED [ 72%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_blocked_prompts[rt_01] XPASS [ 73%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_blocked_prompts[rt_02] XPASS [ 75%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_blocked_prompts[rt_03] XPASS [ 76%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_blocked_prompts[rt_04] XPASS [ 77%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_blocked_prompts[rt_05] XPASS [ 78%]
tests/unit/test_redteam.py::TestRedTeamGuardrails::test_safe_input_passes PASSED [ 79%]
tests/unit/test_retriever.py::TestRetrieverInterface::test_retriever_is_abstract PASSED [ 80%]
tests/unit/test_retriever.py::TestRetrieverInterface::test_json_kb_retriever_is_retriever PASSED [ 81%]
tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_finds_imv PASSED [ 82%]
tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_finds_empadronamiento PASSED [ 83%]
tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_no_match PASSED [ 84%]
tests/unit/test_retriever.py::TestGetRetriever::test_get_retriever_returns_json PASSED [ 85%]
tests/unit/test_retriever.py::TestGetRetriever::test_get_retriever_returns_retriever PASSED [ 86%]
tests/unit/test_structured_outputs.py::test_structured_response_model_validation PASSED [ 87%]
tests/unit/test_structured_outputs.py::test_structured_response_defaults PASSED [ 88%]
tests/unit/test_structured_outputs.py::test_structured_response_rejects_missing_required PASSED [ 89%]
tests/unit/test_structured_outputs.py::test_parse_valid_json PASSED      [ 90%]
tests/unit/test_structured_outputs.py::test_parse_invalid_json_fallback PASSED [ 91%]
tests/unit/test_structured_outputs.py::test_parse_markdown_json_block PASSED [ 92%]
tests/unit/test_structured_outputs.py::test_parse_generic_code_block PASSED [ 93%]
tests/unit/test_structured_outputs.py::test_parse_partial_json_fallback PASSED [ 94%]
tests/unit/test_structured_outputs.py::test_parse_display_no_steps PASSED [ 95%]
tests/unit/test_structured_outputs.py::test_flag_off_no_impact PASSED    [ 96%]
tests/unit/test_transcribe.py::test_whisper_model_none_when_disabled PASSED [ 97%]
tests/unit/test_transcribe.py::test_whisper_model_truthy_when_enabled PASSED [ 98%]
tests/unit/test_transcribe.py::test_whisper_model_none_when_no_key PASSED [100%]

======================== 91 passed, 5 xpassed in 0.87s =========================
  => PASS

>>> Step 2/4: Running ruff lint...
All checks passed!
  => PASS

>>> Step 3/4: Docker build...
#10 naming to docker.io/library/civicaid-voice:phase3 done
#10 unpacking to docker.io/library/civicaid-voice:phase3 done
#10 DONE 0.0s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/q63c9jskw6m5vehne301e8wmq
  => PASS

>>> Step 4/4: Docker container /health check...
  Container started: c3f8bc883a7f
{
    "components": {
        "cache_entries": 8,
        "demo_mode": true,
        "ffmpeg_available": false,
        "gemini_key_set": true,
        "llm_live": false,
        "twilio_configured": true,
        "whisper_enabled": false,
        "whisper_loaded": false
    },
    "status": "ok",
    "uptime_s": 3
}
  cache_entries=8 >= 8
  => PASS

=============================================
 PHASE 3 VERIFICATION SUMMARY
=============================================
 PASS:  4
 FAIL:  0
 SKIP:  0
 TOTAL: 4
=============================================
 Evidence saved to: docs/07-evidence/phase3-verify-output.txt
=============================================
 RESULT: OK — all executed steps passed
