# Q1.1 — Biblioteca Oficial v0: Final Report

**Date:** 2026-02-18
**Status:** COMPLETE (post-audit fixes applied; see FORENSIC-AUDIT-REPORT for 10 resolved findings)
**Goal:** Convert Q1 research markdown into machine-readable, schema-validated artifacts for Clara's RAG pipeline.

---

## Executive Summary

The Biblioteca Oficial v0 delivers a schema-validated, machine-readable foundation for Clara's knowledge base. All Q1 research (AGE, CCAA, municipal sources) has been converted into structured YAML registries, JSON schemas, and governance policies with automated validation gates.

### 10 Key Bullets

1. **44 government sources** cataloged in `registry.yaml` (25 AGE + 19 CCAA), validated against JSON Schema
2. **20 municipal sedes** in `local_seed.yaml` with tier strategy metadata for scaling to 8,131 municipalities
3. **Domain governance** enforced: allowlist (22 AGE + 19 CCAA + 20 municipal domains), blocklist (23 domains + 4 patterns), 12-step URL canonicalization pipeline (applying 10 named rules)
4. **ProcedureDoc v1 schema** (296 lines) defines 29 fields for normalized procedure documents — IMV sample validates at 86% completeness
5. **4 validation scripts** (`validate_source_registry.py`, `validate_policy.py`, `validate_proceduredoc_schema.py`, `link_check.py`) — all executable; 3 schema validators pass; link_check.py passes in dry-run/smoke mode (3 URLs tested, full registry not yet scanned)
6. **Link checker** supports smoke mode, dry-run, JSONL output, per-domain rate limiting — live test: 3/3 URLs OK (avg 229ms)
7. **5 unit tests** (3 happy-path + 2 negative) covering schema validators pass in CI-compatible pytest
8. **5 of 6 gates passed cleanly** (G1-G3, G5-G6); G4 (link checker) passed in smoke/dry-run mode only. All 4 abort conditions cleared (A1-A4).
9. **No `src/` files touched** — all changes in `data/`, `schemas/`, `scripts/`, `tests/`, `docs/`
10. **Q2/Q3 backlog updated** with next steps: embeddings, vector DB, retrieval integration

---

## Source Coverage

| Jurisdiction | Count | Gov. Tier | Priority P0 |
|-------------|-------|-----------|-------------|
| AGE | 25 | Tier 1 (AGE) | 10 |
| CCAA | 19 | Tier 2 (CCAA) | 5 |
| Local (seed) | 20 | Tier 3 (Municipal) | 0 |
| **Total** | **64** | — | **15** |

---

## Artifacts Created

### Data Files

| File | Lines | Description |
|------|-------|-------------|
| `data/sources/registry.yaml` | ~800 | 44 sources (25 AGE + 19 CCAA) |
| `data/sources/local_seed.yaml` | 413 | 20 municipal sedes + tier strategy |
| `data/sources/README.md` | 22 | How to add a source |
| `data/policy/allowlist.yaml` | 362 | 3-tier domain allowlist |
| `data/policy/blocklist.yaml` | 72 | Blocked domains/patterns |
| `data/policy/canonical_rules.yaml` | 233 | 12-step URL normalization |
| `data/policy/README.md` | 22 | How policy is applied |

### Schemas

| File | Lines | Description |
|------|-------|-------------|
| `schemas/SourceRegistry.v1.schema.json` | 191 | JSON Schema Draft 2020-12 for registry |
| `schemas/ProcedureDoc.v1.schema.json` | 296 | JSON Schema for procedure documents |
| `schemas/README.md` | 19 | Schema overview |

### Scripts

| File | Description |
|------|-------------|
| `scripts/validate_source_registry.py` | Validates registry + local_seed against schema |
| `scripts/validate_policy.py` | Structural validation of allowlist/blocklist/canonical |
| `scripts/validate_proceduredoc_schema.py` | Validates a ProcedureDoc JSON against schema |
| `scripts/link_check.py` | HTTP health checker with smoke/dry-run/JSONL |

### Tests

| File | Tests | Status |
|------|-------|--------|
| `tests/unit/test_validators.py` | 5 | 5/5 PASS |

### Evidence

| File | Description |
|------|-------------|
| `evidence/samples/registry.sample.yaml` | 3-entry registry sample |
| `evidence/samples/proceduredoc.sample.json` | IMV mapped to ProcedureDoc v1 |
| `evidence/samples/link_check_output.sample.jsonl` | Sample JSONL output |

---

## Gate Results

| Gate | Description | Result | Evidence |
|------|-------------|--------|----------|
| G1 | registry.yaml validates against schema | PASS | 44 sources (25 AGE + 19 CCAA) |
| G2 | Policy files validate | PASS | allowlist + blocklist + canonical |
| G3 | ProcedureDoc schema + sample validates | PASS | IMV completeness 0.86 |
| G4 | Link checker smoke test | PASS | 3/3 URLs OK, JSONL generated |
| G5 | Docs updated with paths + usage | PASS | READMEs in data/, schemas/ |
| G6 | Backlog Q2/Q3 updated | PASS | See Q2Q3Q4-backlog.md |

## Abort Conditions Cleared

| Condition | Status | Evidence |
|-----------|--------|----------|
| A1 - Registry covers AGE+CCAA+Local | CLEAR | 25 AGE + 19 CCAA + 20 Local seed |
| A2 - Policy enforceable with tiers | CLEAR | 3-tier allowlist, explicit reject-by-default |
| A3 - Reproducible validation/gates | CLEAR | 4 scripts, all runnable, 5 pytest tests |
| A4 - Report + evidence present | CLEAR | This report + evidence/samples/ |

---

## Commands to Run Gates

```bash
# G1: Registry validation
python3 scripts/validate_source_registry.py

# G2: Policy validation
python3 scripts/validate_policy.py

# G3: ProcedureDoc schema validation
python3 scripts/validate_proceduredoc_schema.py \
  "docs/arreglos chat/fase-3/q1-sources/evidence/samples/proceduredoc.sample.json"

# G4: Link checker smoke (dry-run)
python3 scripts/link_check.py --smoke --limit 10 --dry-run

# G4: Link checker smoke (live, 5 URLs)
python3 scripts/link_check.py --smoke --limit 5 --output /tmp/smoke.jsonl

# G5: Unit tests
pytest tests/unit/test_validators.py -v
```

---

## Next Steps (Q2/Q3)

See `docs/arreglos chat/fase-3/q1-sources/backlog/Q2Q3Q4-backlog.md` for full roadmap.

**Q2 priorities:**
- Implement ingestion pipeline (`src/core/ingestion/`)
- Add vector DB (Chroma/Qdrant) for embeddings
- Connect retriever.py to registry sources
- Expand link checker to full health monitoring

**Q3 priorities:**
- Scale local sources beyond seed 20
- Add multilingual extraction (ca, eu, gl)
- Implement freshness monitoring + alerting
