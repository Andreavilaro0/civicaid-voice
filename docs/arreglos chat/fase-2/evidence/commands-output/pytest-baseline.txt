============================= test session starts ==============================
platform darwin -- Python 3.14.3, pytest-9.0.2, pluggy-1.6.0 -- /opt/homebrew/opt/python@3.14/bin/python3.14
cachedir: .pytest_cache
rootdir: /Users/andreaavila/Documents/hakaton/civicaid-voice
configfile: pyproject.toml
plugins: anyio-4.12.0, xonsh-0.20.0
collecting ... collected 111 items / 1 deselected / 1 skipped / 110 selected

Documents/hakaton/civicaid-voice/tests/e2e/test_demo_flows.py::test_t9_wa_text_demo_complete PASSED [  0%]
Documents/hakaton/civicaid-voice/tests/e2e/test_demo_flows.py::test_t10_wa_audio_demo_stub PASSED [  1%]
Documents/hakaton/civicaid-voice/tests/e2e/test_demo_flows.py::test_health_endpoint PASSED [  2%]
Documents/hakaton/civicaid-voice/tests/e2e/test_demo_flows.py::test_static_cache_mp3 PASSED [  3%]
Documents/hakaton/civicaid-voice/tests/integration/test_pipeline.py::test_t8_pipeline_text_cache_hit PASSED [  4%]
Documents/hakaton/civicaid-voice/tests/integration/test_twilio_stub.py::test_send_final_message_text_only PASSED [  5%]
Documents/hakaton/civicaid-voice/tests/integration/test_twilio_stub.py::test_send_final_message_with_media PASSED [  6%]
Documents/hakaton/civicaid-voice/tests/integration/test_webhook.py::test_t6_webhook_text PASSED [  7%]
Documents/hakaton/civicaid-voice/tests/integration/test_webhook.py::test_t7_webhook_audio PASSED [  8%]
Documents/hakaton/civicaid-voice/tests/integration/test_webhook.py::test_webhook_returns_twiml_xml PASSED [  9%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_t1_cache_match_keyword_exact PASSED [ 10%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_t2_cache_match_no_match PASSED [ 10%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_t3_cache_match_image_demo PASSED [ 11%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_cache_match_french PASSED [ 12%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_cache_match_language_fallback PASSED [ 13%]
Documents/hakaton/civicaid-voice/tests/unit/test_cache.py::test_cache_match_empty_text PASSED [ 14%]
Documents/hakaton/civicaid-voice/tests/unit/test_config.py::test_config_defaults PASSED [ 15%]
Documents/hakaton/civicaid-voice/tests/unit/test_config.py::test_config_demo_mode PASSED [ 16%]
Documents/hakaton/civicaid-voice/tests/unit/test_config.py::test_config_twilio_sandbox_default PASSED [ 17%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_input.py::test_text_input PASSED [ 18%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_input.py::test_audio_input PASSED [ 19%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_input.py::test_image_input PASSED [ 20%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_input.py::test_unknown_media_type PASSED [ 20%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_lang.py::test_t5_detect_french PASSED [ 21%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_lang.py::test_detect_spanish PASSED [ 22%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_lang.py::test_detect_short_text_defaults PASSED [ 23%]
Documents/hakaton/civicaid-voice/tests/unit/test_detect_lang.py::test_detect_empty_defaults PASSED [ 24%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_load_eval_cases PASSED [ 25%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_load_eval_cases_missing_dir PASSED [ 26%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_run_eval_case_pass PASSED [ 27%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_run_eval_case_fail_missing PASSED [ 28%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_run_eval_case_fail_unexpected PASSED [ 29%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_run_eval_case_no_checks PASSED [ 30%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_run_eval_set PASSED [ 30%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_eval_report_generation PASSED [ 31%]
Documents/hakaton/civicaid-voice/tests/unit/test_evals.py::test_eval_runner_with_cache PASSED [ 32%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm PASSED [ 33%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm_suicid PASSED [ 34%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_violence PASSED [ 35%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_illegal PASSED [ 36%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_self_harm_suicidarme PASSED [ 37%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_blocks_falsificar_nie PASSED [ 38%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_allows_safe_input PASSED [ 39%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_allows_tramite_questions PASSED [ 40%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_pre_check_allows_empadronamiento PASSED [ 40%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_adds_legal_disclaimer PASSED [ 41%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_adds_medical_disclaimer PASSED [ 42%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_no_disclaimer_for_simple_info PASSED [ 43%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_no_duplicate_disclaimer PASSED [ 44%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_redacts_dni PASSED [ 45%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_redacts_nie PASSED [ 46%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_redacts_phone PASSED [ 47%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_post_check_preserves_clean_text PASSED [ 48%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_guardrails_flag_default_on PASSED [ 49%]
Documents/hakaton/civicaid-voice/tests/unit/test_guardrails.py::test_guardrails_flag_can_be_disabled PASSED [ 50%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_t4_kb_lookup_empadronamiento PASSED [ 50%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_imv PASSED [ 51%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_tarjeta PASSED [ 52%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_no_match PASSED [ 53%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_accent_insensitive PASSED [ 54%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_mixed_accents PASSED [ 55%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_prestacion_desempleo PASSED [ 56%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_desempleo_sepe PASSED [ 57%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_desempleo_french PASSED [ 58%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_nie PASSED [ 59%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_extranjeria PASSED [ 60%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_nie_french PASSED [ 60%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_ayuda_alquiler PASSED [ 61%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_bono_joven PASSED [ 62%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_alquiler_french PASSED [ 63%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_justicia_gratuita PASSED [ 64%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_turno_oficio PASSED [ 65%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_justicia_french PASSED [ 66%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_certificado_discapacidad PASSED [ 67%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_minusvalia PASSED [ 68%]
Documents/hakaton/civicaid-voice/tests/unit/test_kb_lookup.py::test_kb_lookup_discapacidad_french PASSED [ 69%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_build_kb_context_includes_priority_fields PASSED [ 70%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_build_kb_context_excludes_metadata PASSED [ 70%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_build_kb_context_valid_json_always PASSED [ 71%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_build_kb_context_respects_max_chars PASSED [ 72%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_llm_generate_disabled_returns_fallback PASSED [ 73%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_llm_generate_no_api_key_returns_fallback PASSED [ 74%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_prompt_uses_xml_delimiters PASSED [ 75%]
Documents/hakaton/civicaid-voice/tests/unit/test_llm_generate.py::test_prompt_contains_anti_injection_instruction PASSED [ 76%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_request_context_creation PASSED [ 77%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_timing_tracking PASSED [ 78%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_to_dict PASSED [ 79%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_context_thread_local PASSED [ 80%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_clear_context PASSED [ 80%]
Documents/hakaton/civicaid-voice/tests/unit/test_observability.py::test_observability_flag_off PASSED [ 81%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestRetrieverInterface::test_retriever_is_abstract PASSED [ 82%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestRetrieverInterface::test_json_kb_retriever_is_retriever PASSED [ 83%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_finds_imv PASSED [ 84%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_finds_empadronamiento PASSED [ 85%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestJSONKBRetriever::test_json_kb_retriever_no_match PASSED [ 86%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestGetRetriever::test_get_retriever_returns_json PASSED [ 87%]
Documents/hakaton/civicaid-voice/tests/unit/test_retriever.py::TestGetRetriever::test_get_retriever_returns_retriever PASSED [ 88%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_structured_response_model_validation PASSED [ 89%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_structured_response_defaults PASSED [ 90%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_structured_response_rejects_missing_required PASSED [ 90%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_valid_json PASSED [ 91%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_invalid_json_fallback PASSED [ 92%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_markdown_json_block PASSED [ 93%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_generic_code_block PASSED [ 94%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_partial_json_fallback PASSED [ 95%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_parse_display_no_steps PASSED [ 96%]
Documents/hakaton/civicaid-voice/tests/unit/test_structured_outputs.py::test_flag_off_no_impact PASSED [ 97%]
Documents/hakaton/civicaid-voice/tests/unit/test_transcribe.py::test_whisper_model_none_when_disabled PASSED [ 98%]
Documents/hakaton/civicaid-voice/tests/unit/test_transcribe.py::test_whisper_model_truthy_when_enabled PASSED [ 99%]
Documents/hakaton/civicaid-voice/tests/unit/test_transcribe.py::test_whisper_model_none_when_no_key PASSED [100%]

================= 110 passed, 1 skipped, 1 deselected in 0.73s =================
